enum Role {
  USER
  ADMIN
}

enum FieldType {
  TEXT
  NUMBER
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  username  String  @unique
  password  String
  firstName String?
  lastName  String?
  role      Role    @default(USER)

  department   Department? @relation(fields: [departmentId], references: [id])
  departmentId Int?
}

model Department {
  id    Int    @id @default(autoincrement())
  name  String
  users User[]
}

model Product {
  id   Int    @id @default(autoincrement())
  name String
}

// PROCESS TEMPLATE
model ProcessTemplate {
  id   Int    @id @default(autoincrement())
  name String

  fields      ProcessFieldTemplate[]
  stages      ProcessStageTemplate[]
  stageFlows  ProcessStageFlowTemplate[]
  stageFields ProcessStageFieldTemplate[]
}

model ProcessFieldTemplate {
  id   Int    @id @default(autoincrement())
  name String

  formFields ProcessStageFieldTemplate[]

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

model ProcessStageTemplate {
  id   Int    @id @default(autoincrement())
  name String

  fields    ProcessStageFieldTemplate[]
  flowsFrom ProcessStageFlowTemplate[]  @relation("flowsFrom")
  flowsTo   ProcessStageFlowTemplate[]  @relation("flowsTo")

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

model ProcessStageFlowTemplate {
  id    Int     @id @default(autoincrement())
  value String?

  stage   ProcessStageTemplate @relation("flowsFrom", fields: [stageId], references: [id])
  stageId Int

  nextStage   ProcessStageTemplate @relation("flowsTo", fields: [nextStageId], references: [id])
  nextStageId Int

  field   ProcessStageFieldTemplate? @relation(fields: [fieldId], references: [id])
  fieldId Int?

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

model ProcessStageFieldTemplate {
  id          Int       @id @default(autoincrement())
  type        FieldType @default(TEXT)
  label       String?
  description String?
  placeholder String?

  flows ProcessStageFlowTemplate[]

  stage   ProcessStageTemplate @relation(fields: [stageId], references: [id])
  stageId Int

  field   ProcessFieldTemplate @relation(fields: [fieldId], references: [id])
  fieldId Int

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

// END PROCESS TEMPLATE
