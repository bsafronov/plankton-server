enum Role {
  USER
  ADMIN
}

enum FieldType {
  TEXT
  NUMBER
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  username  String  @unique
  password  String
  firstName String?
  lastName  String?
  role      Role    @default(USER)

  department   Department? @relation(fields: [departmentId], references: [id])
  departmentId Int?
}

model Department {
  id    Int    @id @default(autoincrement())
  name  String
  users User[]
}

model Product {
  id   Int    @id @default(autoincrement())
  name String
}

// PROCESS TEMPLATE
model ProcessTemplate {
  id Int @id @default(autoincrement())

  fields ProcessFieldTemplate[]
  stages ProcessStageTemplate[]
}

model ProcessFieldTemplate {
  id   Int    @id @default(autoincrement())
  name String

  formFields ProcessStageFormFieldTemplate[]

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

model ProcessStageTemplate {
  id   Int    @id @default(autoincrement())
  name String

  form ProcessStageFormTemplate?

  conditions ProcessStageFormConditionTemplate[]

  template   ProcessTemplate @relation(fields: [templateId], references: [id])
  templateId Int
}

model ProcessStageFormTemplate {
  id            Int     @id @default(autoincrement())
  hasConditions Boolean @default(false)

  fields     ProcessStageFormFieldTemplate[]
  conditions ProcessStageFormConditionTemplate[]

  stage   ProcessStageTemplate? @relation(fields: [stageId], references: [id])
  stageId Int?                  @unique
}

model ProcessStageFormConditionTemplate {
  id Int @id @default(autoincrement())

  stage   ProcessStageTemplate @relation(fields: [stageId], references: [id])
  stageId Int

  field   ProcessStageFormFieldTemplate @relation(fields: [fieldId], references: [id])
  fieldId Int

  form   ProcessStageFormTemplate @relation(fields: [formId], references: [id])
  formId Int
}

model ProcessStageFormFieldTemplate {
  id          Int       @id @default(autoincrement())
  type        FieldType @default(TEXT)
  label       String?
  description String?
  placeholder String?

  conditions ProcessStageFormConditionTemplate[]

  form   ProcessStageFormTemplate @relation(fields: [formId], references: [id])
  formId Int

  field   ProcessFieldTemplate @relation(fields: [fieldId], references: [id])
  fieldId Int
}

// END PROCESS TEMPLATE
